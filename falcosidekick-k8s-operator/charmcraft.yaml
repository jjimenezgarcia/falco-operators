# Copyright 2025 Canonical Ltd.
# See LICENSE file for licensing details.
# This file configures Charmcraft.
# See https://canonical-charmcraft.readthedocs-hosted.com/stable/howto/manage-charmcraft/
# for guidance.

name: falcosidekick-k8s
type: charm
title: Falcosidekick K8s Operator
summary: Juju charmed operator for Falcosidekick
description: |
  The Falcosidekick K8s Operator is a Juju charmed operator that simplifies the deployment
  and management of Falcosidekick, an open-source daemon for connecting Falco to your ecosystem.

links:
  contact: https://launchpad.net/~canonical-is-devops
  documentation: https://charmhub.io/falcosidekick-k8s
  issues: https://github.com/canonical/falco-operators/issues
  source: https://github.com/canonical/falco-operators

platforms:
  ubuntu@24.04:amd64:

assumes:
  - k8s-api

charm-libs:
  - lib: loki_k8s.loki_push_api
    version: "1"
  - lib: traefik_k8s.ingress
    version: "2"

parts:
  charm:
    source: .
    plugin: uv
    build-packages:
      - git
    build-snaps:
      - astral-uv

config:
  options:
    port:
      type: int
      default: 2801
      description: |
        The port to listen for the falcosidekick daemon (default: 2801). Allowed values are between
        1 and 65535.

containers:
  falcosidekick:
    resource: falcosidekick-image

resources:
  falcosidekick-image:
    type: oci-image
    description: OCI image for the falcosidekick container

requires:
  send-loki-logs:
    limit: 1
    interface: loki_push_api
  certificates:
    limit: 1
    interface: tls-certificates
  ingress:
    limit: 1
    interface: ingress

provides:
  http-endpoint:
    interface: falcosidekick_http_endpoint
